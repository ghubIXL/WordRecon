<html>
  <head>
    <title>Word Recognition Training</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noindex">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f4f4f4; /* Light background for overall page */
        color: #333;
        line-height: 1.6;
        margin: 0;
        padding: 0; /* Remove body padding, apply to inner container for flexbox */
        box-sizing: border-box;
        display: flex; /* Use flexbox for overall layout */
        flex-direction: column; /* Stack children vertically */
        min-height: 100vh; /* Ensure body takes full viewport height */
      }
      .app-container { /* New container to hold all visible content */
        display: flex;
        flex-direction: column;
        flex-grow: 1; /* Allows this container to fill available vertical space */
        box-sizing: border-box;
        max-width: 840px; /* Consistent max-width for both sections + padding */
        margin: 0 auto; /* Center the entire app container */
        height: 100vh; /* Ensure it takes full viewport height */
        padding: 20px; /* Padding for the entire app container */
        gap: 20px; /* Space between controls and mainContentWrapper */
      }
      h1 {
        color: #0056b3;
        margin: 0 auto 20px auto; /* Center heading, add bottom margin */
        text-align: center;
        font-size: 2.5em;
        border-bottom: 2px solid #0056b3;
        padding-bottom: 10px;
        width: 100%; /* Ensure heading takes full width of app-container */
      }
      h2, h3, h4 {
        color: #0056b3;
        margin-top: 25px;
        margin-bottom: 15px;
        font-weight: 600;
      }

      /* Base button and select styles for consistency */
      button, select {
        background-color: #fff;
        border: none;
        border-radius: 8px;
        height: 2.5rem;
        padding: 0 15px;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.1s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      select {
       -webkit-appearance: none;
       -moz-appearance: none;
       appearance: none;
       padding-right: 30px;
     }

     input[type=range] {
      -moz-appearance: none;
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #ddd;
      outline: none;
      opacity: 0.7;
      transition: opacity .2s;
      border-radius: 5px;
     }
     input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007bff;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
     }
     input[type=range]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #007bff;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
     }
     input[type=range]::-ms-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #007bff;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
     }
     input[type=range]::-ms-track {
        background: transparent;
        border-color: transparent;
        color: transparent;
     }
     input[type=range]::-ms-fill-lower {
        background: #ddd;
        border-radius: 5px;
     }
     input[type=range]::-ms-fill-upper {
        background: #ddd;
        border-radius: 5px;
     }

      /* Top Controls Section - General Styling */
      .controls {
          width: 100%;
          flex-basis: 33.33%; /* Occupy 1/3 of parent's height */
          flex-shrink: 0; /* Prevent shrinking */
          overflow-y: auto; /* Enable vertical scrolling */
          background-color: #fff; /* Match lower section background */
          padding: 15px 20px;
          border: 1px solid #ddd; /* Match lower section border */
          border-radius: 10px; /* Match lower section border-radius */
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Match lower section shadow */
          z-index: 1000;
          display: flex;
          flex-direction: column; /* Stack control groups vertically */
          gap: 5px; /* Smaller gap between control groups */
          box-sizing: border-box;
          /* Removed margin-bottom as gap handles spacing in app-container */
      }
      .controls .control-group:last-of-type {
        margin-bottom: 0; /* No margin after the last group */
      }

      /* Top Controls - Compact Group Styling */
      .controls .control-group {
        display: flex;
        align-items: center;
        gap: 8px; /* Gap between elements in a group */
        margin-bottom: 8px; /* Smaller margin between control groups */
      }
      .controls .control-group label {
        white-space: nowrap;
        font-weight: 500;
        color: #555;
        flex-shrink: 0; /* Prevent label from shrinking */
        width: auto; /* Allow label to take natural width */
        min-width: 50px; /* Minimum width for labels */
      }
      .controls .control-group select,
      .controls .control-group input[type="text"],
      .controls .control-group input[type="range"] {
        flex-grow: 1; /* Allow inputs to take remaining space */
        height: 2rem; /* Compact height */
        padding: 4px 8px; /* Compact padding */
        font-size: 0.85em; /* Smaller font size */
        border: 1px solid #ccc; /* Add border for text inputs/select */
        border-radius: 5px; /* Slightly less rounded for compactness */
      }
      .controls .control-group span { /* For value labels (1.0, 1.0 sec) */
        white-space: nowrap;
        font-size: 0.85em;
        font-weight: bold;
        color: #0056b3;
        flex-shrink: 0; /* Prevent from shrinking */
        min-width: 40px; /* Give some minimum space */
        text-align: right;
      }

      /* Reset Button Styling (Matching lower section buttons) */
      .controls .control-group button.reset-button {
        height: 2rem; /* Match input height */
        width: auto; /* Auto width for text */
        padding: 4px 10px; /* Padding for text */
        font-size: 0.85em; /* Match input font size */
        background-color: #6c757d; /* Grey for reset */
        color: white;
        border-radius: 6px; /* Match lower section button radius */
        box-shadow: 0 3px 6px rgba(0,0,0,0.1); /* Match lower section shadow */
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      .controls .control-group button.reset-button:hover {
        background-color: #5a6268;
        transform: translateY(-1px);
      }

      /* Top Section Action Buttons (Word 1, Word 2, First, Second, Listen Pair, Test) */
      .controls .control-group button.play-word,
      .controls .control-group button.listen-pair,
      .controls .control-group button.test-pair {
        padding: 10px 15px; /* Match lower section buttons */
        font-size: 0.95em; /* Match lower section buttons */
        border-radius: 6px; /* Match lower section buttons */
        height: auto; /* Auto height for text content */
        background-color: #28a745; /* Default green */
        color: white;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        flex-grow: 1; /* Allow them to grow within their group */
        min-width: unset; /* Remove min-width inherited from general button */
      }
      .controls .control-group button.play-word:hover,
      .controls .control-group button.listen-pair:hover,
      .controls .control-group button.test-pair:hover {
        background-color: #218838;
        transform: translateY(-1px);
      }
      .controls .control-group button.listen-pair {
          background-color: #007bff;
      }
      .controls .control-group button.listen-pair:hover {
          background-color: #0056b3;
      }
      .controls .control-group button.test-pair {
          background-color: #ffc107;
          color: #333;
      }
      .controls .control-group button.test-pair:hover {
          background-color: #e0a800;
      }


      /* Minimal Pair Section (Bottom) - Existing styles, ensuring consistency */
      #mainContentWrapper {
          flex-basis: 66.66%; /* Occupy 2/3 of parent's height */
          flex-grow: 1; /* Allows content to take remaining vertical space */
          overflow-y: auto; /* Allows content to scroll independently */
          padding-top: 5px; /* Small padding at the top of the scrollable area */
          box-sizing: border-box; /* Include padding/border in width */
      }
      .category-container, .subcategory-container, .contrast-group {
          margin: 0 auto 30px auto;
          padding: 20px;
          border: 1px solid #ddd;
          border-radius: 10px;
          background-color: #fff;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
          width: 100%; /* Ensure they take full width of mainContentWrapper */
          box-sizing: border-box; /* Include padding/border in width */
      }
      .subcategory-container {
          margin-top: 20px;
          background-color: #f9f9f9;
          border-color: #eee;
          box-shadow: none;
      }
      .contrast-group {
          margin-top: 15px;
          padding: 15px;
          border: 1px dashed #ccc;
          background-color: #fafafa;
          border-radius: 8px;
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
      }
      .pair-section {
          display: flex;
          flex-direction: column;
          gap: 8px;
          margin-bottom: 5px;
          padding-bottom: 5px;
          border-bottom: 1px dotted #eee;
          width: 100%;
      }
      .contrast-group .pair-section:last-child {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
      }
      .pair-label {
          font-weight: bold;
          font-size: 1.1em;
          color: #555;
      }
      .button-pair {
          display: flex;
          align-items: center;
          flex-wrap: wrap;
          gap: 10px;
      }
      .button-pair button {
          padding: 10px 15px;
          font-size: 0.95em;
          border-radius: 6px;
          height: auto;
          background-color: #28a745;
          color: white;
          box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      }
      .button-pair button:hover {
          background-color: #218838;
          transform: translateY(-1px);
      }
      /* Specific colors for listen/test buttons in lower section */
      .button-pair button.listen-pair {
          background-color: #007bff;
      }
      .button-pair button.listen-pair:hover {
          background-color: #0056b3;
      }
      .button-pair button.test-pair {
          background-color: #ffc107;
          color: #333;
      }
      .button-pair button.test-pair:hover {
          background-color: #e0a800;
      }

      #pauseValue {
          min-width: 70px;
          text-align: center;
          font-weight: bold;
          color: #0056b3;
      }

      #loadingStatus {
          font-weight: bold;
          color: #dc3545;
          margin-top: 10px;
      }

      /* Custom Modal Styles (unchanged) */
      .modal-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 2000;
      }

      .modal-content {
          background-color: #fff;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
          text-align: center;
          max-width: 90%;
          width: 450px;
          animation: fadeIn 0.3s ease-out;
      }

      .modal-content p {
          font-size: 1.4em;
          margin-bottom: 25px;
          color: #333;
          font-weight: 600;
      }

      .modal-buttons {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-bottom: 20px;
      }

      .modal-buttons button {
          flex: 1;
          max-width: 180px;
          padding: 15px 25px;
          font-size: 1.2em;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: background-color 0.2s ease, transform 0.1s ease;
          box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      }

      .modal-buttons button:hover {
          background-color: #0056b3;
          transform: translateY(-1px);
      }

      .feedback-message {
          margin-top: 20px;
          font-weight: bold;
          font-size: 1.5em;
          animation: slideIn 0.5s ease-out;
      }

      .feedback-message.correct {
          color: #28a745;
      }

      .feedback-message.wrong {
          color: #dc3545;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-20px); }
          to { opacity: 1; transform: translateY(0); }
      }

      @keyframes slideIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }
      /* Responsive adjustments */
      @media (max-width: 768px) {
          h1 {
              font-size: 2em;
              margin: 15px;
          }
          .category-container, .subcategory-container, .contrast-group {
              margin: 0 10px 20px 10px;
              padding: 15px;
          }
          .controls {
              padding: 10px;
              gap: 10px;
          }
          .controls .control-group {
              flex-wrap: nowrap; /* Prevent wrapping within a control group */
              justify-content: space-between; /* Distribute items */
              gap: 5px; /* Smaller gap */
          }
          .controls .control-group label,
          .controls .control-group span {
              font-size: 0.75em; /* Even smaller font size for labels and values */
              min-width: unset; /* Allow them to shrink as much as needed */
              flex-shrink: 0;
          }
          .controls .control-group input[type="text"],
          .controls .control-group select {
              flex-grow: 1;
              min-width: 40px; /* Allow text inputs/selects to shrink more */
              height: 1.8rem;
              font-size: 0.8em;
              padding: 3px 6px;
          }
          .controls .control-group input[type="range"] {
              flex-grow: 1;
              min-width: 50px; /* Allow slider to shrink more */
              height: 6px; /* Make slider track thinner */
          }
          .controls .control-group button { /* Applies to reset and action buttons */
              height: 1.8rem;
              padding: 3px 8px;
              font-size: 0.8em;
              flex-shrink: 0; /* Prevent buttons from shrinking */
          }
          /* Specific overrides for action buttons in the last control group */
          .controls .control-group:last-of-type button {
              padding: 8px 10px; /* Slightly more padding for these action buttons */
              font-size: 0.85em; /* Slightly larger font for action buttons */
          }
          .app-container {
              padding: 10px; /* Smaller padding for the whole container on mobile */
          }
      }
    </style>
  </head>
  <body class="loading">
    <div class="app-container">
        <h1>Word Recognition Training</h1>

        <!-- Top Controls Section -->
        <div class="controls" id="stickyControls">
            <div class="control-group">
                <label for="voiceSelect">Select Voice:</label>
                <select id="voiceSelect"></select>
            </div>

            <div class="control-group">
                <label for="pitchSlider">Pitch:</label>
                <input id="pitchSlider" type="range" value="1" min="0" max="2" step="0.1">
                <span id="pitchValue">1.0</span>
                <button type="button" class="reset-button" aria-label="Reset pitch" title="Reset pitch" onclick="resetPitch();">Reset</button>
            </div>
            <div class="control-group">
                <label for="rateSlider">Rate:</label>
                <input id="rateSlider" type="range" value="1" min="0.1" max="10" step="0.1">
                <span id="rateValue">1.0</span>
                <button type="button" class="reset-button" aria-label="Reset rate" title="Reset rate" onclick="resetRate();">Reset</button>
            </div>
            <div class="control-group">
                <label for="volumeSlider">Volume:</label>
                <input id="volumeSlider" type="range" value="1" min="0" max="1" step="0.05">
                <span id="volumeValue">1.0</span>
                <button type="button" class="reset-button" aria-label="Reset volume" title="Reset volume" onclick="resetVolume();">Reset</button>
            </div>

            <div class="control-group">
                <label for="pauseSlider">Pause:</label>
                <input type="range" id="pauseSlider" min="100" max="3000" value="1000" step="100">
                <span id="pauseValue">1.0 sec</span>
            </div>

            <div class="control-group">
                <label for="textBox1">Word 1:</label>
                <input type="text" id="textBox1" value="Red">
                <label for="textBox2">Word 2:</label>
                <input type="text" id="textBox2" value="Read">
            </div>

            <div class="control-group">
                <button id="speakFirstWordButton" class="play-word">First</button>
                <button id="speakSecondWordButton" class="play-word">Second</button>
                <button id="speakCustomPairButton" class="listen-pair">Listen Pair</button>
                <button id="testCustomPairButton" class="test-pair">Test</button>
            </div>
        </div>

        <div id="mainContentWrapper">
            <div id="wordButtonsContainer">
                <!-- Word categories and buttons will be dynamically loaded here -->
            </div>
        </div>
    </div> <!-- End of app-container -->

    <!-- Custom Modal for Test Functionality -->
    <div id="testModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="modalQuestion">Which word did you hear?</p>
            <div class="modal-buttons">
                <button id="modalOption1"></button>
                <button id="modalOption2"></button>
            </div>
            <p id="modalFeedback" class="feedback-message"></p>
        </div>
    </div>

    <script type="text/javascript">
        // Embedded JSON Data for Minimal Pairs
        const embeddedWordData = [
            {
                "category": "Initial Consonant",
                "subcategories": [
                    {
                        "name": "Differing by Place (where the sound is made)",
                        "contrasts": [
                            {
                                "description": "/p/ vs. /t/",
                                "pairs": [
                                    ["Pan", "Tan"], ["Pin", "Tin"], ["Pot", "Tot"], ["Pick", "Tick"], ["Pale", "Tale"], ["Pat", "Tat"], ["Pill", "Till"], ["Pug", "Tug"], ["Pest", "Test"], ["Pore", "Tore"], ["Pea", "Tea"], ["Pace", "Taste"], ["Pipe", "Type"], ["Pool", "Tool"], ["Pail", "Tail"]
                                ]
                            },
                            {
                                "description": "/b/ vs. /d/",
                                "pairs": [
                                    ["Bat", "Dat"], ["Big", "Dig"], ["Bell", "Dell"], ["Buy", "Dye"], ["Back", "Dack"]
                                ]
                            },
                            {
                                "description": "/p/ vs. /k/",
                                "pairs": [
                                    ["Pat", "Cat"], ["Pool", "Cool"], ["Pear", "Care"], ["Page", "Cage"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /n/",
                                "pairs": [
                                    ["Mat", "Nat"], ["Me", "Knee"], ["Might", "Night"], ["Met", "Net"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /s/",
                                "pairs": [
                                    ["Fin", "Sin"], ["Fan", "San"], ["Fast", "Sass"], ["Fox", "Socks"]
                                ]
                            },
                            {
                                "description": "/z/ vs. /dʒ/",
                                "pairs": [
                                    ["zest", "jest"], ["zeal", "jail"]
                                ]
                            },                           
                            {
                                "description": "/ʃ/ vs. /s/",
                                "pairs": [
                                    ["Sheep", "Seep"], ["Shun", "Sun"], ["Shame", "Same"], ["Shin", "Sin"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Differing by Voicing (vocal cords vibrating or not)",
                        "contrasts": [
                            {
                                "description": "/p/ vs. /b/",
                                "pairs": [
                                    ["Pat", "Bat"], ["Pig", "Big"], ["Pin", "Bin"], ["Pie", "Buy"], ["Pit", "Bit"]
                                ]
                            },
                            {
                                "description": "/t/ vs. /d/",
                                "pairs": [
                                    ["To", "Do"], ["Tip", "Dip"], ["Ten", "Den"], ["Tie", "Die"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /g/",
                                "pairs": [
                                    ["Cat", "Gat"], ["Cut", "Gut"], ["Kiss", "Guess"], ["Came", "Game"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /v/",
                                "pairs": [
                                    ["Fan", "Van"], ["Fine", "Vine"], ["Fat", "Vat"], ["Few", "View"]
                                ]
                            },
                            {
                                "description": "/s/ vs. /z/",
                                "pairs": [
                                    ["Seal", "Zeal"], ["Sink", "Zink"], ["Sip", "Zip"]
                                ]
                            },
                            {
                                "description": "/θ/ vs. /ð/",
                                "pairs": [
                                    ["Thin", "Then"], ["Thigh", "Thy"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Differing by Manner (how the air flows)",
                        "contrasts": [
                            {
                                "description": "/p/ (Stop) vs. /f/ (Fricative)",
                                "pairs": [
                                    ["Pan", "Fan"], ["Pat", "Fat"], ["Pill", "Fill"]
                                ]
                            },
                            {
                                "description": "/d/ (Stop) vs. /n/ (Nasal)",
                                "pairs": [
                                    ["Den", "Nen"], ["Dare", "Nair"]
                                ]
                            },
                            {
                                "description": "/tʃ/ (Affricate) vs. /ʃ/ (Fricative)",
                                "pairs": [
                                    ["Cheer", "Shear"], ["Chip", "Ship"], ["Chop", "Shop"]
                                ]
                            },
                            {
                                "description": "/dʒ/ (Affricate) vs. /z/ (Fricative)",
                                "pairs": [
                                    ["jag", "zag"], ["jeep", "zeep"], ["jest", "zest"]
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "category": "Final Consonant",
                "subcategories": [
                    {
                        "name": "Differing by Voicing",
                        "contrasts": [
                            {
                                "description": "/t/ vs. /d/ (Alveolar Stop)",
                                "pairs": [
                                    ["Beat", "Bead"], ["Hat", "Had"], ["Sit", "Sid"], ["Pat", "Pad"], ["Bet", "Bed"]
                                ]
                            },
                            {
                                "description": "/p/ vs. /b/ (Bilabial Stop)",
                                "pairs": [
                                    ["Cap", "Cab"], ["Rip", "Rib"], ["Tap", "Tab"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /g/ (Velar Stop)",
                                "pairs": [
                                    ["Back", "Bag"], ["Lock", "Log"], ["Pick", "Pig"]
                                ]
                            },
                            {
                                "description": "/s/ vs. /z/ (Alveolar Fricative)",
                                "pairs": [
                                    ["Peace", "Peas"], ["Race", "Raise"], ["Bus", "Buzz"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Differing by Place",
                        "contrasts": [
                            {
                                "description": "/m/ vs. /n/ (Nasal)",
                                "pairs": [
                                    ["Swim", "Swin"], ["Team", "Teen"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /ŋ/ (Alveolar vs. Velar Nasal)",
                                "pairs": [
                                    ["Sin", "Sing"], ["Ran", "Rang"], ["Win", "Wing"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Differing by Manner",
                        "contrasts": [
                            {
                                "description": "/t/ (Stop) vs. /s/ (Fricative)",
                                "pairs": [
                                    ["Hat", "Hass"], ["Pat", "Pass"]
                                ]
                            },
                            {
                                "description": "/d/ (Stop) vs. /z/ (Fricative)",
                                "pairs": [
                                    ["Aid", "Aze"], ["Bid", "Biz"]
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "category": "Vowels",
                "subcategories": [
                    {
                        "name": "Short vs. Long/Tense Vowels",
                        "contrasts": [
                            {
                                "description": "/ɪ/ (short i) vs. /iː/ (long e)",
                                "pairs": [
                                    ["Bin", "Bean"], ["Fit", "Feet"], ["Lip", "Leap"], ["Sip", "Seep"], ["Dill", "Deal"]
                                ]
                            },
                            {
                                "description": "/æ/ (short a) vs. /ɑː/ (broad a)",
                                "pairs": [
                                    ["Cat", "Cart"], ["Bad", "Bard"]
                                ]
                            },
                            {
                                "description": "/ʊ/ (short u) vs. /uː/ (long oo)",
                                "pairs": [
                                    ["Look", "Luke"], ["Pull", "Pool"], ["Should", "Shooed"]
                                ]
                            },
                            {
                                "description": "/ɛ/ (short e) vs. /eɪ/ (long a)",
                                "pairs": [
                                    ["Met", "Mate"], ["Wet", "Wait"], ["Sell", "Sail"], ["Bed", "Bade"]
                                ]
                            },
                            {
                                "description": "/ʌ/ (short u as in 'cut') vs. /ɔː/ (aw as in 'caught')",
                                "pairs": [
                                    ["Cut", "Caught"], ["Duck", "Dock"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Front vs. Back Vowels",
                        "contrasts": [
                            {
                                "description": "/iː/ (long e) vs. /uː/ (long oo)",
                                "pairs": [
                                    ["Feel", "Fool"], ["Leave", "Looze"]
                                ]
                            },
                            {
                                "description": "/æ/ (short a) vs. /ɑː/ (broad a)",
                                "pairs": [
                                    ["Cab", "Cob"], ["Cat", "Cot"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Monophthongs vs. Diphthongs",
                        "contrasts": [
                            {
                                "description": "/ɑː/ (broad a) vs. /aɪ/ (long i)",
                                "pairs": [
                                    ["Dad", "Died"], ["Cop", "Cope"]
                                ]
                            },
                            {
                                "description": "/ɔː/ (aw) vs. /oʊ/ (long o)",
                                "pairs": [
                                    ["Cot", "Coat"], ["Not", "Note"]
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "category": "Consonant Clusters",
                "subcategories": [
                    {
                        "name": "Initial Clusters",
                        "contrasts": [
                            {
                                "description": "/s/ vs. /st/",
                                "pairs": [
                                    ["Sit", "Stir"], ["Sip", "Stripe"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /sl/",
                                "pairs": [
                                    ["Led", "Sled"], ["Light", "Slight"]
                                ]
                            },
                            {
                                "description": "/p/ vs. /sp/",
                                "pairs": [
                                    ["Pin", "Spin"], ["Peak", "Speak"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Final Clusters",
                        "contrasts": [
                            {
                                "description": "/mp/ vs. /nt/",
                                "pairs": [
                                    ["Camp", "Cant"], ["Dump", "Dunt"]
                                ]
                            },
                            {
                                "description": "/st/ vs. /sk/",
                                "pairs": [
                                    ["Last", "Lask"], ["Test", "Tesk"]
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "category": "Medial Consonant",
                "subcategories": [
                    {
                        "name": "Voicing",
                        "contrasts": [
                            {
                                "description": "/t/ vs. /d/",
                                "pairs": [
                                    ["Meta", "Medal"], ["City", "Cider"]
                                ]
                            }
                        ]
                    },
                    {
                        "name": "Place",
                        "contrasts": [
                            {
                                "description": "/n/ vs. /m/",
                                "pairs": [
                                    ["Winner", "Whimper"], ["Denim", "Demin"]
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                "category": "All Consonants",
                "subcategories": [
                    {
                        "name": "All Pairs",
                        "contrasts": [
                            {
                                "description": "/b/ vs. /m/",
                                "pairs": [
                                    ["bat", "mat"],
                                    ["bite", "might"],
                                    ["bum", "mum"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /p/",
                                "pairs": [
                                    ["mip", "pip"],
                                    ["mat", "pat"],
                                    ["might", "pight"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /t/",
                                "pairs": [
                                    ["mat", "tat"],
                                    ["might", "tight"],
                                    ["moan", "tone"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /m/",
                                "pairs": [
                                    ["dad", "mad"],
                                    ["debt", "met"],
                                    ["dob", "mob"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /m/",
                                "pairs": [
                                    ["cat", "mat"],
                                    ["kite", "might"],
                                    ["coo", "moo"]
                                ]
                            },
                            {
                                "description": "/g/ vs. /m/",
                                "pairs": [
                                    ["gat", "mat"],
                                    ["gob", "mob"],
                                    ["goo", "moo"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /m/",
                                "pairs": [
                                    ["fan", "man"],
                                    ["fee", "me"],
                                    ["fight", "might"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /v/",
                                "pairs": [
                                    ["met", "vet"],
                                    ["me", "Vee"],
                                    ["more", "vore"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /s/",
                                "pairs": [
                                    ["mass", "sass"],
                                    ["me", "see"],
                                    ["might", "sight"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /z/",
                                "pairs": [
                                    ["moo", "zoo"],
                                    ["me", "Z"],
                                    ["maze", "gaze"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /ʃ/",
                                "pairs": [
                                    ["me", "she"],
                                    ["might", "shite"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /m/",
                                "pairs": [
                                    ["mare", "hair"],
                                    ["me", "he"],
                                    ["might", "height"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /n/",
                                "pairs": [
                                    ["mail", "nail"],
                                    ["man", "nan"],
                                    ["moat", "note"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /ŋ/",
                                "pairs": [
                                    ["hum", "hung"],
                                    ["ram", "rang"],
                                    ["whim", "wing"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /m/",
                                "pairs": [
                                    ["lap", "map"],
                                    ["light", "might"],
                                    ["low", "mow"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /r/",
                                "pairs": [
                                    ["mare", "rare"],
                                    ["might", "right"],
                                    ["mo", "roe"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /w/",
                                "pairs": [
                                    ["may", "way"],
                                    ["meat", "wheat"],
                                    ["mo", "woe"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /j/",
                                "pairs": [
                                    ["mew", "yew"],
                                    ["might", "yite"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /p/",
                                "pairs": [
                                    ["nip", "pip"],
                                    ["knack", "pack"],
                                    ["nin", "pin"]
                                ]
                            },
                            {
                                "description": "/b/ vs. /n/",
                                "pairs": [
                                    ["bun", "none"],
                                    ["buy", "nigh"],
                                    ["bet", "net"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /t/",
                                "pairs": [
                                    ["noon", "tune"],
                                    ["nigh", "tie"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /n/",
                                "pairs": [
                                    ["day", "nay"],
                                    ["deer", "near"],
                                    ["den", "none"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /n/",
                                "pairs": [
                                    ["can", "nan"],
                                    ["coat", "note"],
                                    ["key", "knee"]
                                ]
                            },
                            {
                                "description": "/g/ vs. /n/",
                                "pairs": [
                                    ["innate", "gate"],
                                    ["new", "goo"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /n/",
                                "pairs": [
                                    ["fan", "nan"],
                                    ["fine", "nine"],
                                    ["fit", "knit"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /v/",
                                "pairs": [
                                    ["nan", "van"],
                                    ["kneel", "veal"],
                                    ["nest", "vest"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /θ/",
                                "pairs": [
                                    ["none", "thin"],
                                    ["numb", "thumb"],
                                    ["naught", "thought"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /ð/",
                                "pairs": [
                                    ["none", "then"],
                                    ["know", "though"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /s/",
                                "pairs": [
                                    ["none", "sun"],
                                    ["nip", "sip"],
                                    ["knack", "sack"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /z/",
                                "pairs": [
                                    ["new", "zoo"],
                                    ["nap", "zap"],
                                    ["Ned", "zed"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /ʃ/",
                                "pairs": [
                                    ["none", "shin"],
                                    ["no", "show"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /n/",
                                "pairs": [
                                    ["nan", "hand"],
                                    ["near", "hear"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /tʃ/",
                                "pairs": [
                                    ["nip", "chip"],
                                    ["new", "chew"],
                                    ["N", "chin"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /dʒ/",
                                "pairs": [
                                    ["net", "jet"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /ŋ/",
                                "pairs": [
                                    ["ran", "rang"],
                                    ["sin", "sing"],
                                    ["sun", "sung"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /n/",
                                "pairs": [
                                    ["nip", "lip"],
                                    ["night", "light"],
                                    ["no", "low"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /r/",
                                "pairs": [
                                    ["gnat", "rat"],
                                    ["Ned", "red"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /w/",
                                "pairs": [
                                    ["nag", "wag"],
                                    ["net", "wet"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /j/",
                                "pairs": [
                                    ["new", "yew"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /t/",
                                "pairs": [
                                    ["edge", "etch"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /f/",
                                "pairs": [
                                    ["Jan", "fan"],
                                    ["gin", "fin"],
                                    ["jar", "far"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /z/",
                                "pairs": [
                                    ["gauge", "gaze"],
                                    ["budge", "buzz"],
                                    ["jest", "zest"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /ʃ/",
                                "pairs": [
                                    ["badge", "batch"],
                                    ["ridge", "rich"],
                                    ["surge", "search"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /ʒ/",
                                "pairs": [
                                    ["pledger", "pleasure"],
                                    ["ledger", "leisure"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /h/",
                                "pairs": [
                                    ["Jim", "him"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /tʃ/",
                                "pairs": [
                                    ["jug", "chug"],
                                    ["joke", "choke"],
                                    ["gin", "chin"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /j/",
                                "pairs": [
                                    ["jet", "yet"],
                                    ["gel", "yell"],
                                    ["jarred", "yard"]
                                ]
                            },
                            {
                                "description": "/ʒ/ vs. /s/",
                                "pairs": [
                                    ["allusion", "allu*sion"],
                                    ["*fusion", "fusion"]
                                ]
                            },
                            {
                                "description": "/ʒ/ vs. /z/",
                                "pairs": [
                                    ["beige", "bays"],
                                    ["rouge", "ruse"],
                                    ["luge", "lose"]
                                ]
                            },
                            {
                                "description": "/ʃ/ vs. /ʒ/",
                                "pairs": [
                                    ["measure", "pleasure"],
                                    ["vision", "fission"],
                                    ["allusion", "Aleutian"]
                                ]
                            },
                            {
                                "description": "/tʃ/ vs. /t/",
                                "pairs": [
                                    ["catch", "cat"],
                                    ["match", "mat"],
                                    ["ouch", "out"]
                                ]
                            },
                            {
                                "description": "/tʃ/ vs. /d/",
                                "pairs": [
                                    ["catch", "cadge"],
                                    ["chew", "do"],
                                    ["batch", "bad"]
                                ]
                            },
                            {
                                "description": "/s/ vs. /tʃ/",
                                "pairs": [
                                    ["chop", "shop"],
                                    ["chip", "ship"],
                                    ["catch", "cash"]
                                ]
                            },
                            {
                                "description": "/tʃ/ vs. /z/",
                                "pairs": [
                                    ["chest", "zest"],
                                    ["chips", "zips"],
                                    ["chew", "zoo"]
                                ]
                            },
                            {
                                "description": "/ʃ/ vs. /tʃ/",
                                "pairs": [
                                    ["chair", "share"],
                                    ["cheap", "sheep"],
                                    ["chew", "shoe"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /tʃ/",
                                "pairs": [
                                    ["chair", "hair"],
                                    ["chip", "hip"]
                                ]
                            },
                            {
                                "description": "/tʃ/ vs. /dʒ/",
                                "pairs": [
                                    ["chug", "jug"],
                                    ["choke", "joke"],
                                    ["chin", "gin"]
                                ]
                            },
                            {
                                "description": "/p/ vs. /r/",
                                "pairs": [
                                    ["peach", "reach"],
                                    ["pain", "rain"],
                                    ["pack", "rack"]
                                ]
                            },
                            {
                                "description": "/b/ vs. /r/",
                                "pairs": [
                                    ["bow", "row"],
                                    ["bed", "red"],
                                    ["bug", "rug"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /t/",
                                "pairs": [
                                    ["reach", "teach"],
                                    ["rack", "tack"],
                                    ["rail", "tail"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /r/",
                                "pairs": [
                                    ["dough", "row"],
                                    ["die", "rye"],
                                    ["dead", "red"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /r/",
                                "pairs": [
                                    ["cat", "rat"],
                                    ["coast", "roast"],
                                    ["cash", "rash"]
                                ]
                            },
                            {
                                "description": "/g/ vs. /r/",
                                "pairs": [
                                    ["go", "row"],
                                    ["guy", "rye"],
                                    ["gag", "rag"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /r/",
                                "pairs": [
                                    ["fan", "ran"],
                                    ["fig", "rig"],
                                    ["foe", "row"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /v/",
                                "pairs": [
                                    ["ran", "van"],
                                    ["real", "veal"],
                                    ["rail", "veil"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /θ/",
                                "pairs": [
                                    ["Rick", "thick"],
                                    ["rink", "think"],
                                    ["raw", "thaw"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /ð/",
                                "pairs": [
                                    ["rose", "those"],
                                    ["ray", "they"],
                                    ["rare", "their"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /s/",
                                "pairs": [
                                    ["rail", "sail"],
                                    ["real", "seal"],
                                    ["rand", "sand"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /z/",
                                "pairs": [
                                    ["room", "zoom"],
                                    ["red", "zed"],
                                    ["rack", "Zack"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /ʃ/",
                                "pairs": [
                                    ["rain", "Shane"],
                                    ["rack", "shack"],
                                    ["rod", "shod"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /r/",
                                "pairs": [
                                    ["heap", "reap"],
                                    ["hail", "rail"],
                                    ["heel", "reel"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /tʃ/",
                                "pairs": [
                                    ["rat", "chat"],
                                    ["rain", "chain"],
                                    ["race", "chase"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /r/",
                                "pairs": [
                                    ["Jane", "rain"],
                                    ["jeep", "reap"],
                                    ["Jack", "rack"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /r/",
                                "pairs": [
                                    ["main", "rain"],
                                    ["mail", "rail"],
                                    ["meal", "real"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /r/",
                                "pairs": [
                                    ["knack", "rack"],
                                    ["nail", "rail"],
                                    ["kneel", "real"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /r/",
                                "pairs": [
                                    ["lamp", "ramp"],
                                    ["lace", "race"],
                                    ["lake", "rake"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /w/",
                                "pairs": [
                                    ["wag", "rag"],
                                    ["wed", "red"],
                                    ["wok", "rock"]
                                ]
                            },
                            {
                                "description": "/j/ vs. /r/",
                                "pairs": [
                                    ["yay", "ray"],
                                    ["you", "rue"],
                                    ["yacht", "rot"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /p/",
                                "pairs": [
                                    ["lick", "pick"],
                                    ["line", "pine"],
                                    ["lunch", "punch"]
                                ]
                            },
                            {
                                "description": "/b/ vs. /l/",
                                "pairs": [
                                    ["beef", "leaf"],
                                    ["bite", "light"],
                                    ["base", "lace"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /t/",
                                "pairs": [
                                    ["Lou", "two"],
                                    ["lie", "tie"],
                                    ["lap", "tap"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /l/",
                                "pairs": [
                                    ["dough", "low"],
                                    ["die", "lie"],
                                    ["duck", "luck"]
                                ]
                            },
                            {
                                "description": "/k/ vs. /l/",
                                "pairs": [
                                    ["cook", "look"],
                                    ["cash", "lash"],
                                    ["cane", "lane"]
                                ]
                            },
                            {
                                "description": "/g/ vs. /l/",
                                "pairs": [
                                    ["go", "low"],
                                    ["guy", "lie"],
                                    ["gag", "lag"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /l/",
                                "pairs": [
                                    ["fine", "line"],
                                    ["fair", "lair"],
                                    ["fit", "lit"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /v/",
                                "pairs": [
                                    ["line", "vine"],
                                    ["Lee", "V"],
                                    ["let", "vet"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /θ/",
                                "pairs": [
                                    ["lick", "thick"],
                                    ["link", "think"],
                                    ["law", "thaw"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /ð/",
                                "pairs": [
                                    ["Lee", "thee"],
                                    ["lie", "thy"],
                                    ["lay", "they"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /s/",
                                "pairs": [
                                    ["lick", "sick"],
                                    ["line", "sign"],
                                    ["lay", "say"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /z/",
                                "pairs": [
                                    ["Lou", "zoo"],
                                    ["lead", "zed"],
                                    ["Lee", "Z"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /ʃ/",
                                "pairs": [
                                    ["line", "shine"],
                                    ["lot", "shot"],
                                    ["leap", "sheep"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /l/",
                                "pairs": [
                                    ["Lee", "he"],
                                    ["Lou", "who"],
                                    ["laugh", "half"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /tʃ/",
                                "pairs": [
                                    ["Lynne", "chin"],
                                    ["lick", "chick"],
                                    ["lose", "choose"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /ŋ/",
                                "pairs": [
                                    ["will", "wing"],
                                    ["till", "ting"],
                                    ["kill", "king"]
                                ]
                            },
                            {
                                "description": "/w/ vs. /g/",
                                "pairs": [
                                    ["wait", "gate"],
                                    ["wood", "good"],
                                    ["what", "got"]
                                ]
                            },
                            {
                                "description": "/v/ vs. /w/",
                                "pairs": [
                                    ["vet", "wet"],
                                    ["vent", "went"],
                                    ["vine", "wine"]
                                ]
                            },
                            {
                                "description": "/l/ vs. /w/",
                                "pairs": [
                                    ["lead", "weed"],
                                    ["light", "white"],
                                    ["lace", "waste"]
                                ]
                            },
                            {
                                "description": "/r/ vs. /w/",
                                "pairs": [
                                    ["rag", "wag"],
                                    ["red", "wed"],
                                    ["rock", "wok"]
                                ]
                            },
                            {
                                "description": "/w/ vs. /j/",
                                "pairs": [
                                    ["way", "yay"],
                                    ["well", "yell"],
                                    ["west", "yes"]
                                ]
                            },
                            {
                                "description": "/s/ vs. /j/",
                                "pairs": [
                                    ["suit", "ute"],
                                    ["cell", "yell"],
                                    ["cess", "yes"]
                                ]
                            },
                            {
                                "description": "/j/ vs. /ʃ/",
                                "pairs": [
                                    ["you", "shoe"],
                                    ["yell", "shell"],
                                    ["yawl", "shawl"]
                                ]
                            },
                            {
                                "description": "/tʃ/ vs. /j/",
                                "pairs": [
                                    ["chew", "ewe"],
                                    ["cheer", "year"],
                                    ["cello", "yellow"]
                                ]
                            },
                            {
                                "description": "/dʒ/ vs. /j/",
                                "pairs": [
                                    ["jaw", "your"],
                                    ["jot", "yacht"],
                                    ["joke", "yolk"]
                                ]
                            },
                            {
                                "description": "/t/ vs. /θ/",
                                "pairs": [
                                    ["taught", "thought"],
                                    ["team", "theme"],
                                    ["mat", "math"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /θ/",
                                "pairs": [
                                    ["free", "three"],
                                    ["fin", "thin"],
                                    ["four", "thaw"]
                                ]
                            },
                            {
                                "description": "/θ/ vs. /ð/",
                                "pairs": [
                                    ["thin", "then"],
                                    ["thigh", "thy"],
                                    ["breath", "breathe"]
                                ]
                            },
                            {
                                "description": "/s/ vs. /θ/",
                                "pairs": [
                                    ["sick", "thick"],
                                    ["sink", "think"],
                                    ["sum", "thumb"]
                                ]
                            },
                            {
                                "description": "/m/ vs. /θ/",
                                "pairs": [
                                    ["Mick", "thick"],
                                    ["mink", "think"],
                                    ["mum", "thumb"]
                                ]
                            },
                            {
                                "description": "/n/ vs. /θ/",
                                "pairs": [
                                    ["Nick", "thick"],
                                    ["numb", "thumb"],
                                    ["nerd", "third"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /ð/",
                                "pairs": [
                                    ["day", "they"],
                                    ["den", "then"],
                                    ["doe", "though"]
                                ]
                            },
                            {
                                "description": "/v/ vs. /ð/",
                                "pairs": [
                                    ["van", "than"],
                                    ["vie", "thy"],
                                    ["lava", "lather"]
                                ]
                            },
                            {
                                "description": "/z/ vs. /ð/",
                                "pairs": [
                                    ["Zen", "then"],
                                    ["close", "clothe"],
                                    ["bays", "bathe"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /p/",
                                "pairs": [
                                    ["pee", "he"],
                                    ["pie", "hi"],
                                    ["pot", "hot"]
                                ]
                            },
                            {
                                "description": "/b/ vs. /h/",
                                "pairs": [
                                    ["bee", "he"],
                                    ["bay", "hay"],
                                    ["bug", "hug"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /t/",
                                "pairs": [
                                    ["two", "who"],
                                    ["tie", "high"],
                                    ["top", "hop"]
                                ]
                            },
                            {
                                "description": "/d/ vs. /h/",
                                "pairs": [
                                    ["dough", "hoe"],
                                    ["Dee", "he"],
                                    ["dead", "head"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /k/",
                                "pairs": [
                                    ["cart", "heart"],
                                    ["corn", "horn"],
                                    ["calf", "half"]
                                ]
                            },
                            {
                                "description": "/g/ vs. /h/",
                                "pairs": [
                                    ["gate", "hate"],
                                    ["go", "hoe"],
                                    ["goal", "hole"]
                                ]
                            },
                            {
                                "description": "/f/ vs. /h/",
                                "pairs": [
                                    ["farm", "harm"],
                                    ["feel", "heel"],
                                    ["fat", "hat"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /v/",
                                "pairs": [
                                    ["heel", "veal"],
                                    ["hail", "veil"],
                                    ["hear", "veer"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /θ/",
                                "pairs": [
                                    ["hick", "thick"],
                                    ["Hank", "thank"],
                                    ["hum", "thumb"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /ð/",
                                "pairs": [
                                    ["hose", "those"],
                                    ["hem", "them"],
                                    ["hay", "they"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /s/",
                                "pairs": [
                                    ["heat", "seat"],
                                    ["hip", "sip"],
                                    ["heel", "seal"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /z/",
                                "pairs": [
                                    ["who", "zoo"],
                                    ["head", "zed"],
                                    ["he", "Z"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /ʃ/",
                                "pairs": [
                                    ["he", "she"],
                                    ["hi", "shy"],
                                    ["hot", "shot"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /tʃ/",
                                "pairs": [
                                    ["hop", "chop"],
                                    ["who", "chew"],
                                    ["high", "chi"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /dʒ/",
                                "pairs": [
                                    ["he", "gee"],
                                    ["heap", "jeep"],
                                    ["hen", "Jen"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /m/",
                                "pairs": [
                                    ["me", "he"],
                                    ["my", "hi"],
                                    ["mop", "hop"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /n/",
                                "pairs": [
                                    ["knee", "he"],
                                    ["knot", "hot"],
                                    ["nip", "hip"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /l/",
                                "pairs": [
                                    ["Lee", "he"],
                                    ["Lou", "who"],
                                    ["laugh", "half"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /r/",
                                "pairs": [
                                    ["reap", "heap"],
                                    ["rail", "hail"],
                                    ["reel", "heel"]
                                ]
                            },
                            {
                                "description": "/h/ vs. /w/",
                                "pairs": [
                                    ["wall", "hall"],
                                    ["whip", "hip"],
                                    ["wheat", "heat"]
                                ]
                            },
                            {
                                "description": "/j/ vs. /h/",
                                "pairs": [
                                    ["you", "who"],
                                    ["year", "hear"],
                                    ["hack", "yak"]
                                ]
                            }
                        ]
                    }
                ]
            }
        ];


        var voices = [];
        const synth = window.speechSynthesis; // Re-declare synth for scope

        // Minimal Pair Specific Elements
        const wordButtonsContainer = document.getElementById('wordButtonsContainer');
        const voiceSelect = document.getElementById('voiceSelect'); // This is the primary voice select now

        const textBox1 = document.getElementById('textBox1');
        const textBox2 = document.getElementById('textBox2');
        const speakFirstWordButton = document.getElementById('speakFirstWordButton');
        const speakSecondWordButton = document.getElementById('speakSecondWordButton');
        const speakCustomPairButton = document.getElementById('speakCustomPairButton');
        const testCustomPairButton = document.getElementById('testCustomPairButton');

        const pauseSlider = document.getElementById('pauseSlider');
        const pauseValue = document.getElementById('pauseValue');
        const stickyControls = document.getElementById('stickyControls');
        const mainContentWrapper = document.getElementById('mainContentWrapper');

        // New slider elements
        const pitchSlider = document.getElementById('pitchSlider');
        const pitchValue = document.getElementById('pitchValue');
        const rateSlider = document.getElementById('rateSlider');
        const rateValue = document.getElementById('rateValue');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');


        // Modal elements
        const testModal = document.getElementById('testModal');
        const modalQuestion = document.getElementById('modalQuestion');
        const modalOption1 = document.getElementById('modalOption1');
        const modalOption2 = document.getElementById('modalOption2');
        const modalFeedback = document.getElementById('modalFeedback');

        let currentPauseDurationMs = parseInt(pauseSlider.value);
        let correctWord = ''; // Variable to store the correct word for the test

        // Removed isSpeechInProgress flag. Relying on synth.speaking.

        function populateVoiceList() {
          voices = synth.getVoices().sort((a, b) => {
              const aname = a.name.toUpperCase();
              const bname = b.name.toUpperCase();
              if (aname < bname) return -1;
              if (aname > bname) return +1;
              return 0;
          });

          voiceSelect.innerHTML = ''; // Clear minimal pair voice select

          if (voices.length === 0) {
              console.warn("No voices available. This might be due to browser limitations or voices not being loaded yet.");
              voiceSelect.innerHTML = '<option value="">No Voices Available</option>';
              return;
          }

          let defaultVoiceFound = false;

          for (var i = 0; i < voices.length; i++) {
            var option = document.createElement('option');
            option.textContent = `${voices[i].name} (${voices[i].lang})`;
            option.setAttribute('data-index', i); // Store index for minimal pair logic

            if (voices[i].default || (voices[i].lang === 'en-US' && !defaultVoiceFound)) {
              option.selected = true;
              defaultVoiceFound = true;
            }
            voiceSelect.appendChild(option);
          }

          // Fallback if no default or en-US voice was found
          if (!defaultVoiceFound && voices.length > 0) {
              voiceSelect.options[0].selected = true;
          }
          console.log("Voice list populated. Total voices:", voices.length);
        }

        populateVoiceList();
        if (synth.onvoiceschanged !== undefined)
          synth.onvoiceschanged = populateVoiceList;

        // Helper function to get the selected voice for minimal pairs
        function getSelectedVoiceForMinimalPairs() {
            const selectedIndex = voiceSelect.selectedIndex;
            return voices[selectedIndex]; // Use the global 'voices' array
        }

        // Helper function to wait for speech to stop
        async function waitForSpeechToStopMinimalPairs() {
            if (synth.speaking) {
                synth.cancel();
                // Actively poll until synth.speaking is false, using requestAnimationFrame for efficiency
                await new Promise(resolve => {
                    const checkSpeechState = () => {
                        if (!synth.speaking) {
                            resolve();
                        } else {
                            requestAnimationFrame(checkSpeechState);
                        }
                    };
                    requestAnimationFrame(checkSpeechState);
                });
            }
        }

        // Speak function for minimal pairs
        async function speakWordMinimalPairs(word) {
            return new Promise(async (resolve) => {
                await waitForSpeechToStopMinimalPairs(); // Ensure previous speech is stopped

                const utterance = new SpeechSynthesisUtterance(word);
                utterance.voice = getSelectedVoiceForMinimalPairs();
                utterance.pitch = parseFloat(pitchSlider.value); // Use value from slider
                utterance.rate = parseFloat(rateSlider.value);   // Use value from slider
                utterance.volume = parseFloat(volumeSlider.value); // Use value from slider

                utterance.onend = () => {
                    resolve(); // Resolve when speech ends naturally
                };
                utterance.onerror = (event) => {
                    // Log all errors, but always resolve to prevent infinite waiting in this context.
                    console.error('SpeechSynthesisUtterance.onerror (Minimal Pairs)', event.error, `Word: "${word}"`);
                    resolve(); // Always resolve to allow the next operation to proceed
                };

                try {
                    if (utterance.voice) {
                        synth.speak(utterance);
                    } else {
                        console.warn("No valid voice selected for minimal pair speech, cannot speak.");
                        resolve(); // Resolve immediately if no voice
                    }
                } catch (e) {
                    console.error("Error calling speechSynthesis.speak (Minimal Pairs):", e);
                    resolve(); // Resolve on unexpected error during speak call
                }
            });
        }

        async function speakPairMinimalPairs(word1, word2) {
            await speakWordMinimalPairs(word1);
            await new Promise(resolve => setTimeout(resolve, currentPauseDurationMs));
            await speakWordMinimalPairs(word2);
        }

        async function speakRepeatedlyMinimalPairs(word, count) {
            for (let i = 0; i < count; i++) {
                await speakWordMinimalPairs(word);
                if (i < count - 1) {
                    await new Promise(resolve => setTimeout(resolve, currentPauseDurationMs));
                }
            }
        }

        // Function to show the test modal
        function showTestModalMinimalPairs(pair) {
            modalOption1.textContent = pair[0];
            modalOption2.textContent = pair[1];
            modalFeedback.textContent = ''; // Clear previous feedback
            modalFeedback.className = 'feedback-message'; // Reset class
            modalOption1.style.display = ''; // Ensure buttons are visible
            modalOption2.style.display = ''; // Ensure buttons are visible
            testModal.style.display = 'flex'; // Show the modal
        }

        // Function to check the user's answer
        function checkAnswerMinimalPairs(userAnswer) {
            if (userAnswer === correctWord) {
                modalFeedback.textContent = 'Correct!';
                modalFeedback.classList.add('correct');
            } else {
                modalFeedback.textContent = `Wrong! It was "${correctWord}".`;
                modalFeedback.classList.add('wrong');
            }
            // Hide modal after a short delay
            setTimeout(() => {
                testModal.style.display = 'none';
                modalFeedback.textContent = ''; // Clear feedback for next test
            }, 2000);
        }

        // Event listeners for modal buttons
        modalOption1.addEventListener('click', () => checkAnswerMinimalPairs(modalOption1.textContent));
        modalOption2.addEventListener('click', () => checkAnswerMinimalPairs(modalOption2.textContent));

        function generateButtons(wordData) {
            wordButtonsContainer.innerHTML = '';
            if (!wordData || wordData.length === 0) {
                wordButtonsContainer.innerHTML = '<p>No word data available.</p>';
                return;
            }

            wordData.forEach(categoryObj => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-container';
                categoryDiv.innerHTML = `<h2>${categoryObj.category}</h2>`;
                wordButtonsContainer.appendChild(categoryDiv);

                const subcategoryArray = categoryObj.subcategories || [];

                subcategoryArray.forEach(subcategoryObj => {
                    const subcategoryDiv = document.createElement('div');
                    subcategoryDiv.className = 'subcategory-container';
                    if (subcategoryObj.name) {
                        subcategoryDiv.innerHTML = `<h3>${subcategoryObj.name}</h3>`;
                    }
                    categoryDiv.appendChild(subcategoryDiv);

                    if (subcategoryObj.description) {
                        const descriptionP = document.createElement('p');
                        descriptionP.textContent = subcategoryObj.description;
                        subcategoryDiv.appendChild(descriptionP);
                    }

                    if (subcategoryObj.contrasts && subcategoryObj.contrasts.length > 0) {
                        subcategoryObj.contrasts.forEach(contrastObj => {
                            const contrastGroupDiv = document.createElement('div');
                            contrastGroupDiv.className = 'contrast-group';
                            const contrastTitle = document.createElement('h4');
                            contrastTitle.textContent = `Contrast: ${contrastObj.description}`;
                            contrastGroupDiv.appendChild(contrastTitle);
                            subcategoryDiv.appendChild(contrastGroupDiv);

                            contrastObj.pairs.forEach(pair => {
                                const pairSectionDiv = document.createElement('div');
                                pairSectionDiv.className = 'pair-section';

                                const pairLabel = document.createElement('span');
                                pairLabel.className = 'pair-label';
                                pairLabel.textContent = `${pair[0]} vs. ${pair[1]}`;
                                pairSectionDiv.appendChild(pairLabel);

                                const buttonPairDiv = document.createElement('div');
                                buttonPairDiv.className = 'button-pair';

                                const button1 = document.createElement('button');
                                button1.textContent = pair[0];
                                button1.setAttribute('data-word1', pair[0]);
                                button1.addEventListener('click', () => speakWordMinimalPairs(pair[0]));
                                buttonPairDiv.appendChild(button1);

                                const button2 = document.createElement('button');
                                button2.textContent = pair[1];
                                button2.setAttribute('data-word2', pair[1]);
                                button2.addEventListener('click', () => speakWordMinimalPairs(pair[1]));
                                buttonPairDiv.appendChild(button2);

                                const speakPairButton = document.createElement('button');
                                speakPairButton.textContent = "Listen Pair";
                                speakPairButton.className = "listen-pair";
                                speakPairButton.setAttribute('data-word-pair-1', pair[0]);
                                speakPairButton.setAttribute('data-word-pair-2', pair[1]);
                                speakPairButton.addEventListener('click', () => speakPairMinimalPairs(pair[0], pair[1]));
                                buttonPairDiv.appendChild(speakPairButton);

                                const testButton = document.createElement('button');
                                testButton.textContent = 'Test';
                                testButton.className = 'test-pair';
                                testButton.addEventListener('click', async () => {
                                    const randomIndex = Math.floor(Math.random() * pair.length);
                                    correctWord = pair[randomIndex];
                                    await speakRepeatedlyMinimalPairs(correctWord, 3);
                                    showTestModalMinimalPairs(pair);
                                });
                                buttonPairDiv.appendChild(testButton);

                                pairSectionDiv.appendChild(buttonPairDiv);
                                contrastGroupDiv.appendChild(pairSectionDiv);
                            });
                        });
                    }
                });
            });
        }

        // --- Event Listeners for custom text boxes/buttons (Minimal Pairs) ---
        speakFirstWordButton.addEventListener('click', () => {
            speakWordMinimalPairs(textBox1.value);
        });

        speakSecondWordButton.addEventListener('click', () => {
            speakWordMinimalPairs(textBox2.value);
        });

        speakCustomPairButton.addEventListener('click', () => {
            speakPairMinimalPairs(textBox1.value, textBox2.value);
        });

        testCustomPairButton.addEventListener('click', async () => {
            const pair = [textBox1.value, textBox2.value];
            if (!pair[0] || !pair[1]) {
                testModal.style.display = 'flex';
                modalQuestion.textContent = "Please enter both words in the text boxes to use the Test feature.";
                modalOption1.style.display = 'none';
                modalOption2.style.display = 'none';
                modalFeedback.textContent = '';
                setTimeout(() => {
                    testModal.style.display = 'none';
                    modalOption1.style.display = '';
                    modalOption2.style.display = '';
                }, 3000);
                return;
            }
            const randomIndex = Math.floor(Math.random() * pair.length);
            correctWord = pair[randomIndex];

            await speakRepeatedlyMinimalPairs(correctWord, 3);
            showTestModalMinimalPairs(pair);
        });

        // --- Event Listeners for Pitch, Rate, Volume Sliders ---
        pitchSlider.addEventListener('input', () => {
            pitchValue.textContent = parseFloat(pitchSlider.value).toFixed(1);
        });
        rateSlider.addEventListener('input', () => {
            rateValue.textContent = parseFloat(rateSlider.value).toFixed(1);
        });
        volumeSlider.addEventListener('input', () => {
            volumeValue.textContent = parseFloat(volumeSlider.value).toFixed(1);
        });

        // Reset functions for sliders
        function resetPitch() {
            pitchSlider.value = 1;
            pitchValue.textContent = '1.0';
        }
        function resetRate() {
            rateSlider.value = 1;
            rateValue.textContent = '1.0';
        }
        function resetVolume() {
            volumeSlider.value = 1;
            volumeValue.textContent = '1.0';
        }

        // --- Event Listener for Pause Slider ---
        pauseSlider.addEventListener('input', () => {
            currentPauseDurationMs = parseInt(pauseSlider.value);
            pauseValue.textContent = (currentPauseDurationMs / 1000).toFixed(1) + " sec";
        });

        // Event Delegation for Dynamically Generated Buttons
        wordButtonsContainer.addEventListener('click', (event) => {
            const target = event.target;
            if (target.tagName === 'BUTTON') {
                // Single word buttons
                if (target.hasAttribute('data-word1') && !target.classList.contains('listen-pair') && !target.classList.contains('test-pair')) {
                    speakWordMinimalPairs(target.getAttribute('data-word1'));
                } else if (target.hasAttribute('data-word2') && !target.classList.contains('listen-pair') && !target.classList.contains('test-pair')) {
                    speakWordMinimalPairs(target.getAttribute('data-word2'));
                }
            }
        });

        // Initial call to generate minimal pair buttons when the DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            generateButtons(embeddedWordData);
        });

    </script>
  </body>
</html>
